(()=>{var e=function(e,t){if(!(e instanceof t))throw new Error("Bound instance method accessed before binding")};jQuery(document).ready((function(t){"use strict";var n;return n=window.WC_Braintree_Apple_Pay_Handler=class extends SV_WC_Apple_Pay_Handler_v5_12_0{constructor(e){super(e),this.on_validate_merchant=this.on_validate_merchant.bind(this),this.process_authorization=this.process_authorization.bind(this),this.store_name=e.store_name,this.client_token_nonce=e.client_token_nonce,this.force_tokenization=e.force_tokenization}is_available(){return window.ApplePaySession&&ApplePaySession.canMakePayments()}init(){if(this.is_available()||t(".sv-wc-external-checkout").hide(),t(document.body).trigger("update_checkout"),this.is_available())return this.instance?super.init():this.create_client()}create_client(){return this.get_client_token().done((e=>{if(e.success)return braintree.client.create({authorization:e.data}).then((e=>(this.client=e,this.create_instance()))).catch((e=>(console.error("Could not create Braintree client"),console.error(e))))})).fail(((e,t,n)=>console.error("Could not retrieve the client token via AJAX: "+n)))}get_client_token(){var e;return e={action:`wc_${this.gateway_id}_get_client_token`,nonce:this.client_token_nonce},t.post(this.ajax_url,e)}create_instance(){return braintree.applePay.create({client:this.client}).then((e=>(this.instance=e,ApplePaySession.canMakePaymentsWithActiveCard(e.merchantIdentifier).then((e=>{if(e)return this.init()}))))).catch((e=>(console.error("Could not create Braintree Apple Pay instance. "+e.message),console.error(e))))}get_new_session(e){var t;return t=this.instance.createPaymentRequest(e),super.get_new_session(t)}on_validate_merchant(t){return e(this,n),this.instance.performValidation({validationURL:t.validationURL,displayName:this.store_name}).then((e=>this.session.completeMerchantValidation(e))).catch((e=>(this.session.abort(),this.fail_payment("Merchant could not be validated. "+e.message))))}process_authorization(t){return e(this,n),this.instance.tokenize({token:t.token}).then((e=>(t.braintree_nonce=e.nonce,t.source="apple_pay",t.force_tokenization=this.force_tokenization,super.process_authorization(t)))).catch((e=>(this.set_payment_status(!1),this.fail_payment("Payment could not be processed. "+e))))}},t(document.body).trigger("wc_braintree_apple_pay_handler_loaded")}))})();