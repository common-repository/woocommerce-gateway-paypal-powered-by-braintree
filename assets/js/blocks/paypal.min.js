(()=>{"use strict";var e={20:(e,t,n)=>{var o=n(609),a=Symbol.for("react.element"),r=Symbol.for("react.fragment"),s=Object.prototype.hasOwnProperty,i=o.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,c={key:!0,ref:!0,__self:!0,__source:!0};function l(e,t,n){var o,r={},l=null,p=null;for(o in void 0!==n&&(l=""+n),void 0!==t.key&&(l=""+t.key),void 0!==t.ref&&(p=t.ref),t)s.call(t,o)&&!c.hasOwnProperty(o)&&(r[o]=t[o]);if(e&&e.defaultProps)for(o in t=e.defaultProps)void 0===r[o]&&(r[o]=t[o]);return{$$typeof:a,type:e,key:l,ref:p,props:r,_owner:i.current}}t.Fragment=r,t.jsx=l,t.jsxs=l},848:(e,t,n)=>{e.exports=n(20)},609:e=>{e.exports=window.React}},t={};const n=window.wc.wcBlocksRegistry,o=window.wc.wcSettings,a="braintree_paypal",r="braintree-paypal";let s=null;const i=()=>{if(null!==s)return s;const e=(0,o.getSetting)(`${a}_data`,null);if(!e)throw new Error("Braintree Paypal initialization data is not available");const t=e.is_checkout_confirmation||!1;return s={ajaxUrl:e.ajax_url||"",buttonStyles:e.button_styles||{},buttonWidth:e.button_width||null,clientTokenNonce:e.client_token_nonce||"",setPaymentMethodNonce:e.set_payment_method_nonce||"",debug:e.debug||!1,description:e.description||"",forceBuyerCountry:e.force_buyer_country||"",integrationErrorMessage:e.integration_error_message||"Unknown error",isTestEnvironment:e.is_test_environment||!1,isPayPalPayLaterEnabled:e.is_paypal_pay_later_enabled||!1,isPayPalCardEnabled:e.is_paypal_card_enabled||!1,logoUrl:e.logo_url||"",messageLogoType:e.messaging_logo_type||"inline",messageLogoPosition:e.messaging_logo_position||"left",messageTextColor:e.messaging_text_color||"black",paymentErrorMessage:e.payment_error_message||"Unknown error",payPalDisabledFundingOptions:e.paypal_disabled_funding_options||[],payPalIntent:e.paypal_intent||"",paypalLocale:e.paypal_locale||"en_us",showSavedCards:e.show_saved_cards&&!t||!1,showSaveOption:e.show_save_option&&!t||!1,supports:e.supports||{},title:e.title||"",tokenizationForced:e.tokenization_forced||!1,isCheckoutConfirmation:e.is_checkout_confirmation||!1,payPalCustomerDetails:e.paypal_customer_details||{},cartPaymentNonce:e.cart_payment_nonce||"",cartHandlerUrl:e.cart_handler_url||"",cartCheckoutEnabled:e.cart_checkout_enabled||!1},s},c=(e,t=null)=>{i().debug&&(console.log(`Braintree (PayPal): ${e}`),t&&console.log(t))},l=window.wp.i18n,p=window.wp.data,d=window.wp.hooks,u=window.wp.element;var m=function n(o){var a=t[o];if(void 0!==a)return a.exports;var r=t[o]={exports:{}};return e[o](r,r.exports,n),r.exports}(848);const{buttonWidth:y,integrationErrorMessage:g}=i(),h=({loadPayPalSDK:e,onError:t,buttonLoaded:n,isCheckoutConfirmation:o=!1})=>{const a=(0,u.useRef)(!1),r="wc-braintree-paypal-button-container";if((0,u.useEffect)((()=>{let o,s;return a.current=!0,async function(){try{const{dataCollectorInstance:t,paypalCheckoutInstance:i}=await e(r,a);a.current&&n(!0),o=i,s=t}catch(e){c(`Integration Error: ${e.message}`,e),t(g)}}(),()=>{a.current=!1,n(!1),o&&o.teardown(),s&&s.teardown()}}),[e,t,n]),o)return null;const s=y?{width:`${y}px`}:{};return(0,m.jsx)("div",{id:r,style:s})},{buttonWidth:w,messageLogoType:_,messageLogoPosition:b,messageTextColor:P,isPayPalPayLaterEnabled:f}=i(),S=({amount:e})=>{const t="wc-braintree-paypal-pay-later-messaging-container";(0,u.useEffect)((()=>{if(!f)return;const n=document.getElementById(t);return n?paypal.Messages?void paypal.Messages({amount:e,style:{layout:"text",logo:{type:_,position:b},text:{color:P}}}).render(`#${t}`).catch((e=>{c(`Could not render the PayPal Pay Later messeging: ${e.message}`,e)})):n.style.display="none":void 0}),[e]);const n=w?{width:`${w}px`}:{};return(0,m.jsx)("div",{id:t,style:n})},k=window.wp.htmlEntities,C=window.wc.blocksCheckout,{description:E,isTestEnvironment:x}=i(),v=({testAmount:e,setTestAmount:t})=>(0,m.jsxs)(m.Fragment,{children:[!!x&&(0,m.jsx)("span",{children:(0,l.__)("TEST MODE ENABLED","woocommerce-gateway-paypal-powered-by-braintree")}),(0,m.jsx)("p",{children:(0,k.decodeEntities)(E||"")}),!!x&&(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(C.ValidatedTextInput,{id:`wc-${r}-test-amount`,type:"text",label:(0,l.__)("Test Amount","woocommerce-gateway-paypal-powered-by-braintree"),value:e,onChange:t}),(0,m.jsx)("p",{style:{fontSize:"10px"},dangerouslySetInnerHTML:{__html:(0,l.sprintf)(/** translators: Placeholders: %1$s - <a> tag, %2$s - </a> tag */ /** translators: Placeholders: %1$s - <a> tag, %2$s - </a> tag */
(0,l.__)("Enter a %1$stest amount%2$s to trigger a specific error response, or leave blank to use the order total.","woocommerce-gateway-paypal-powered-by-braintree"),'<a href="https://developers.braintreepayments.com/reference/general/testing/php#test-amounts">',"</a>")}})]})]});function T(e,t,n){const o=t||new FormData;for(const t in e){if(!e.hasOwnProperty(t)||!e[t])continue;const a=n?`${n}[${t}]`:t;"object"==typeof e[t]?T(e[t],o,a):o.append(a,e[t])}return o}const{ajaxUrl:j,clientTokenNonce:A,isTestEnvironment:R,buttonStyles:M,payPalIntent:D,isPayPalPayLaterEnabled:L,isPayPalCardEnabled:F,payPalDisabledFundingOptions:O,tokenizationForced:$,paypalLocale:I,forceBuyerCountry:B,cartPaymentNonce:N,cartHandlerUrl:U,setPaymentMethodNonce:z,paymentErrorMessage:K}=i(),H=({billing:{cartTotal:e,currency:t},onSubmit:n,shouldSavePayment:o,token:s=null,isExpress:i=!1,needsShipping:l=!1})=>{const[p,d]=(0,u.useState)(N||""),[m,y]=(0,u.useState)(""),[g,h]=(0,u.useState)(""),w=t.code,_=(e.value/10**t.minorUnit).toFixed(2),b=(0,u.useMemo)((()=>!o&&!$),[o]);i&&(M.label="checkout");const P=(0,u.useCallback)(((e,t)=>{const o={env:R?"sandbox":"production",commit:!i,style:M,onApprove:(t,o)=>e.tokenizePayment(t).then((function(e){if(c("Payment tokenized.",e),i&&e)return e.wp_nonce=z,((e,t)=>{if(t&&t.nonce)return fetch(e,{method:"POST",body:T(t)}).then((e=>e.json()))})(U,e).then((e=>{if(!e||!e.redirect_url)throw new Error(K);window.location=e.redirect_url})).catch((e=>{d(""),c(`Payment Error: ${e.message}`,e)}));d(e.nonce),n()})),onError(e){d(""),c(`Payment Error: ${e.message}`,e)}},a=()=>e.createPayment({flow:b?"checkout":"vault",intent:b?D:"tokenize",amount:_,currency:w,locale:I,enableShippingAddress:l});b?o.createOrder=a:o.createBillingAgreement=a;const r=document.getElementById(t);if(r&&(r.innerHTML=""),document.getElementById(t))return paypal.Buttons(o).render(`#${t}`)}),[_,w,i,b,l,n]),f=(0,u.useMemo)((()=>{const[e,t]=[[],O];F||t.push("card"),L?e.push("paylater"):t.push("paylater");const n={components:L?"buttons,messages":"buttons",currency:w,intent:b?D:"tokenize",vault:!b,commit:!i};return e.length&&(n["enable-funding"]=e.join(",")),t.length&&(n["disable-funding"]=t.join(",")),B&&(n["buyer-country"]=B),n}),[w,b,i]),S=(0,u.useCallback)((async(e="",t={})=>{const{braintree:n}=window,o={},r=await((e,t,n)=>{const o=new FormData;return o.append("action",`wc_${t}_get_client_token`),o.append("nonce",n),fetch(e,{method:"POST",body:o}).then((e=>e.json())).then((e=>{if(e&&!e.success){const t=e.data&&e.data.message||"";throw new Error(`Could not retrieve the client token via AJAX: ${t}`)}if(e&&e.success&&e.data)return e.data}))})(j,a,A);c("Creating client");const s=await n.client.create({authorization:r});c("Client ready");try{const e=await n.dataCollector.create({client:s});e&&e.deviceData&&(t.current&&y(e.deviceData),o.dataCollectorInstance=e)}catch(e){c(e)}if(e){c("Creating integration");const t=await n.paypalCheckout.create({client:s});await t.loadPayPalSDK(f),await P(t,e),o.paypalCheckoutInstance=t,c("Integration ready")}return o}),[P,f]),k=(0,u.useCallback)((()=>{const e={wc_braintree_paypal_payment_nonce:p,wc_braintree_device_data:m};return b||(e[`wc-${r}-tokenize-payment-method`]=!0),s&&(e[`wc-${r}-payment-token`]=s,e.token=s,e.isSavedToken=!0),g&&(e[`wc-${r}-test-amount`]=g),e}),[m,b,p,g,s]);return{amount:_,testAmount:g,setTestAmount:h,loadPayPalSDK:S,getPaymentMethodData:k}},Y=({checkoutFormHandler:e,eventRegistration:t,emitResponse:n})=>{const{onPaymentProcessing:o,onCheckoutAfterProcessingWithError:a,onCheckoutAfterProcessingWithSuccess:r}=t,{getPaymentMethodData:s}=e;return((e,t,n)=>{(0,u.useEffect)((()=>e((()=>{const e=n();return e&&(e.token||e.wc_braintree_paypal_payment_nonce)?{type:t.responseTypes.SUCCESS,meta:{paymentMethodData:e}}:{type:t.responseTypes.ERROR,message:i().paymentErrorMessage,messageContext:t.noticeContexts.PAYMENTS}}))),[t.responseTypes.SUCCESS,e,n,t.responseTypes.ERROR,t.noticeContexts.PAYMENTS])})(o,n,s),((e,t,n)=>{(0,u.useEffect)((()=>{const o=e=>{let t={type:n.responseTypes.SUCCESS};const{paymentStatus:o,paymentDetails:a}=e.processingResponse;return o===n.responseTypes.FAIL&&a.result===n.responseTypes.FAIL&&a.message&&(t={type:n.responseTypes.FAIL,message:a.message,messageContext:n.noticeContexts.PAYMENTS,retry:!0}),t},a=e(o),r=t(o);return()=>{a(),r()}}),[e,t,n.noticeContexts.PAYMENTS,n.responseTypes.FAIL,n.responseTypes.SUCCESS])})(a,r,n),null},{isCheckoutConfirmation:W,payPalCustomerDetails:q}=i(),J=(0,o.getSetting)("isBlockTheme")?"wc-block-components-notice-banner is-error":"woocommerce-error",V=(e,t)=>t?(Object.keys(t).forEach((e=>{""===t[e]&&delete t[e]})),{...e,...t}):e,X=e=>{const[t,n]=(0,u.useState)(null),[o,r]=(0,u.useState)(!1),{eventRegistration:s,emitResponse:i,activePaymentMethod:c,components:{LoadingMask:l},billing:d,onSubmit:y,shouldSavePayment:g,token:w,shippingData:_}=e,b=H({billing:d,onSubmit:y,shouldSavePayment:g,token:w,isExpress:!1,needsShipping:_.needsShipping}),{loadPayPalSDK:P,testAmount:f,setTestAmount:k,amount:C}=b;return(0,u.useEffect)((()=>{if(W)return;const e=document.querySelector("button.wc-block-components-checkout-place-order-button");return e?(c===a&&e.setAttribute("disabled","disabled"),()=>{e.removeAttribute("disabled")}):void 0}),[c]),(0,u.useEffect)((()=>{if(W&&q&&!window.wcBraintreePayPalAddressFilled){try{const{billing:e,shipping:t}=q,n=(0,p.select)("wc/store/cart").getCustomerData(),o={};o.billing=V(n.billingAddress,e),o.shipping=V(n.shippingAddress,t),o.billing&&(0,p.dispatch)("wc/store/cart").setBillingAddress(o.billing),_.needsShipping&&o.shipping&&(0,p.dispatch)("wc/store/cart").setShippingAddress(o.shipping)}catch(e){console.error(e)}window.wcBraintreePayPalAddressFilled=!0}}),[]),(0,m.jsxs)(m.Fragment,{children:[!W&&(0,m.jsx)(v,{testAmount:f,setTestAmount:k}),t&&(0,m.jsx)("div",{className:J,children:t}),!t&&(0,m.jsxs)(l,{isLoading:!o,showSpinner:!0,children:[o&&!W&&(0,m.jsx)(S,{amount:C}),(0,m.jsx)(h,{loadPayPalSDK:P,onError:n,buttonLoaded:r,isCheckoutConfirmation:W})]}),(0,m.jsx)(Y,{checkoutFormHandler:b,eventRegistration:s,emitResponse:i})]})},{PAYMENT_STORE_KEY:G}=window.wc.wcBlocksData,{logoUrl:Q,title:Z,showSavedCards:ee,showSaveOption:te,supports:ne,isCheckoutConfirmation:oe}=i(),ae=()=>(0,m.jsx)("img",{src:Q,alt:Z}),re=({RenderedComponent:e,...t})=>(0,p.select)("core/editor")?null:(0,m.jsx)(e,{...t});let se=ne;oe&&((0,d.addAction)("experimental__woocommerce_blocks-checkout-render-checkout-form","woocommerce-gateway-paypal-powered-by-braintree",(()=>{(0,p.dispatch)(G).__internalSetActivePaymentMethod(a)})),se=[...ne,"braintree_paypal_checkout_confirmation"]);const ie={name:a,label:(0,m.jsx)(ae,{}),ariaLabel:(0,l.__)("Braintree PayPal Payment Method","woocommerce-gateway-paypal-powered-by-braintree"),canMakePayment:()=>!0,content:(0,m.jsx)(re,{RenderedComponent:X}),edit:(0,m.jsx)(re,{RenderedComponent:X}),savedTokenComponent:(0,m.jsx)(re,{RenderedComponent:e=>{const{eventRegistration:t,emitResponse:n}=e,o=H(e),{loadPayPalSDK:a}=o,r=(0,u.useRef)(!1);return(0,u.useEffect)((()=>{let e;return r.current=!0,async function(){const{dataCollectorInstance:t}=await a("",r);e=t}(),()=>{r.current=!1,e&&e.teardown&&e.teardown()}}),[a]),(0,m.jsx)(Y,{checkoutFormHandler:o,eventRegistration:t,emitResponse:n})}}),supports:{showSavedCards:ee||!1,showSaveOption:te||!1,features:se||[]}},ce=(0,o.getSetting)("isBlockTheme")?"wc-block-components-notice-banner is-error":"woocommerce-error",le=e=>{const[t,n]=(0,u.useState)(null),[o,a]=(0,u.useState)(!1),{components:{LoadingMask:r},billing:s,onSubmit:i,shouldSavePayment:c,token:l,shippingData:p}=e,d=H({billing:s,onSubmit:i,shouldSavePayment:c,token:l,isExpress:!0,needsShipping:p.needsShipping}),{loadPayPalSDK:y,amount:g}=d;return(0,m.jsxs)(m.Fragment,{children:[t&&(0,m.jsx)("div",{className:ce,children:t}),!t&&(0,m.jsxs)(r,{isLoading:!o,children:[o&&(0,m.jsx)(S,{amount:g}),(0,m.jsx)(h,{loadPayPalSDK:y,onError:n,buttonLoaded:a})]})]})},{supports:pe}=i(),de=({RenderedComponent:e,...t})=>(0,p.select)("core/editor")?null:(0,m.jsx)(e,{...t}),ue={name:a+"_express",canMakePayment:()=>!0,content:(0,m.jsx)(de,{RenderedComponent:le}),edit:(0,m.jsx)(de,{RenderedComponent:le}),supports:{features:pe||[]}},{cartCheckoutEnabled:me}=i();(0,n.registerPaymentMethod)(ie),me&&(0,n.registerExpressPaymentMethod)(ue)})();