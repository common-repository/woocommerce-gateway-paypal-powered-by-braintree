(()=>{"use strict";var e={20:(e,t,r)=>{var n=r(609),s=Symbol.for("react.element"),a=Symbol.for("react.fragment"),o=Object.prototype.hasOwnProperty,i=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,c={key:!0,ref:!0,__self:!0,__source:!0};function d(e,t,r){var n,a={},d=null,l=null;for(n in void 0!==r&&(d=""+r),void 0!==t.key&&(d=""+t.key),void 0!==t.ref&&(l=t.ref),t)o.call(t,n)&&!c.hasOwnProperty(n)&&(a[n]=t[n]);if(e&&e.defaultProps)for(n in t=e.defaultProps)void 0===a[n]&&(a[n]=t[n]);return{$$typeof:s,type:e,key:d,ref:l,props:a,_owner:i.current}}t.Fragment=a,t.jsx=d,t.jsxs=d},848:(e,t,r)=>{e.exports=r(20)},609:e=>{e.exports=window.React}},t={};const r=window.wc.wcBlocksRegistry,n=window.wp.i18n,s=window.wp.data,a="braintree_credit_card",o="braintree-credit-card",i=window.wc.wcSettings;let c=null;const d=()=>{if(null!==c)return c;const e=(0,i.getSetting)(`${a}_data`,null);if(!e)throw new Error("Braintree Credit Card initialization data is not available");return c={ajaxUrl:e.ajax_url||"",cartContainsSubscription:e.cart_contains_subscription||!1,clientTokenNonce:e.client_token_nonce||"",cscRequired:!1!==e.csc_required,debug:e.debug||!1,description:e.description||"",enabledCardTypes:e.enabled_card_types||[],fieldsErrorMessages:e.fields_error_messages||{},hostedFieldsStyles:e.hosted_fields_styles||{},icons:e.icons||{},integrationErrorMessage:e.integration_error_message||"Unknown error",isTestEnvironment:e.is_test_environment||!1,isAdvancedFraudTool:e.is_advanced_fraud_tool||!1,orderTotal3DSecure:e.order_total_for_3ds||0,paymentErrorMessage:e.payment_error_message||"Unknown error",showSavedCards:e.show_saved_cards||!1,showSaveOption:e.show_save_option||!1,supports:e.supports||{},title:e.title||"",threeds:e.threeds||{},tokenDataNonce:e.token_data_nonce||"",tokenizationForced:e.tokenization_forced||!1},c},l=(e=!1)=>{const{cscRequired:t,hostedFieldsStyles:r}=d(),s={styles:{...r,input:{"font-size":"16px","line-height":"1.375"},"::placeholder":{color:"transparent"},":focus::placeholder":{color:"#757575"},".invalid":{color:"#cc1818"}},fields:{}};if(e||(s.fields={number:{selector:"#wc-braintree-credit-card-account-number-hosted",placeholder:"•••• •••• •••• ••••"},expirationDate:{selector:"#wc-braintree-credit-card-expiry-hosted",placeholder:(0,n.__)("MM / YY","woocommerce-gateway-paypal-powered-by-braintree")}}),t){const t=e?"#wc-braintree-credit-card-csc-hosted-token":"#wc-braintree-credit-card-csc-hosted";s.fields.cvv={selector:t,placeholder:(0,n.__)("CSC","woocommerce-gateway-paypal-powered-by-braintree")}}return s},p=(e,t=!1)=>{const r=[],{fieldsErrorMessages:n,cscRequired:s}=d();if(!e||!e.type)return e.message||"";if("CUSTOMER"===e.type)switch(e.code){case"HOSTED_FIELDS_FIELDS_EMPTY":t||(r.push(n.card_number_required),r.push(n.card_expirationDate_required)),s&&r.push(n.card_cvv_required);break;case"HOSTED_FIELDS_FIELDS_INVALID":if(e.details&&e.details.invalidFieldKeys)for(const t of e.details.invalidFieldKeys)r.push(n[`card_${t}_invalid`]||"");break;default:if(r.push(e.message||""),r.push(e.error&&e.error.message||""),e.details&&e.details.originalError){const t=p(e.details.originalError);t&&r.push(t)}}else"NETWORK"===e.type&&e.details&&e.details.originalError&&e.details.originalError.error&&r.push(e.details.originalError.error.message||"");return r.length?r.filter((e=>e)).join(". "):""},u=(e,t=null)=>{d().debug&&(console.log(`Braintree (Credit Card): ${e}`),t&&console.log(t))},m=()=>{const{icons:e={}}=d();return Object.entries(e).map((([e,{src:t,alt:r}])=>({id:e,src:t,alt:r})))},y=window.wp.element,{ajaxUrl:h,clientTokenNonce:g,tokenizationForced:w,threeds:_,isAdvancedFraudTool:b,cartContainsSubscription:f,orderTotal3DSecure:v,cscRequired:S}=d(),x=({billing:e,shippingData:{shippingAddress:t},shouldSavePayment:r,token:n=null})=>{const{cartTotal:s,currency:i}=e,c=(s.value/10**i.minorUnit).toFixed(2),[p,m]=(0,y.useState)(""),[x,E]=(0,y.useState)(""),[C,k]=(0,y.useState)(null),[D,j]=(0,y.useState)(null),T=(0,y.useMemo)((()=>!r&&!w),[r]),F=!!n,R=(0,y.useCallback)((async()=>{const{braintree:e}=window;let t,r,n;const s=_&&_.enabled&&e&&e.threeDSecure,o=await((e,t,r)=>{const n=new FormData;return n.append("action",`wc_${t}_get_client_token`),n.append("nonce",r),fetch(e,{method:"POST",body:n}).then((e=>e.json())).then((e=>{if(e&&!e.success){const t=e.data&&e.data.message||"";throw new Error(`Could not retrieve the client token via AJAX: ${t}`)}if(e&&e.success&&e.data)return e.data}))})(h,a,g);u("Creating client");const i=await e.client.create({authorization:o});return u("Client Ready"),F&&!S||(u("Creating integration"),n=await e.hostedFields.create({...l(F),client:i}),k(n),(e=>{function t(e,t){const r=e.fields[e.emittedBy];r&&r.container.classList.add(t)}function r(e,t){const r=e.fields[e.emittedBy];r&&r.container.classList.remove(t)}e.on("focus",(e=>{t(e,"focused")})),e.on("blur",(e=>{const n=e.fields[e.emittedBy];r(e,"focused"),n.isEmpty&&t(e,"empty")})),e.on("empty",(e=>{t(e,"empty")})),e.on("notEmpty",(function(e){r(e,"empty")})),e.on("cardTypeChange",(function(e){if(!e.cards)return;const t=document.getElementById("wc-braintree-credit-card-account-number-hosted");if(t.classList.forEach((e=>{e.startsWith("card-type-")&&t.classList.remove(e)})),!e.cards.length)return t.classList.add("card-type-invalid");if(1===e.cards.length){const r=e.cards[0],{enabledCardTypes:n}=d();r.type&&n.includes(r.type)?t.classList.add(`card-type-${r.type}`):t.classList.add("card-type-invalid")}}))})(n),u("Integration ready")),b&&e&&e.dataCollector&&(t=await e.dataCollector.create({client:i}),t&&t.deviceData&&E(t.deviceData)),s&&i.getConfiguration().gatewayConfiguration.threeDSecureEnabled&&(r=await e.threeDSecure.create({version:2,client:i}),j(r)),{hostedFields:n,dataCollector:t,threeDSecure:r}}),[F]),M=(0,y.useMemo)((()=>{const r={amount:c.toString(),email:e.billingData.email||"",billingAddress:{givenName:e.billingData.first_name||"",surname:e.billingData.last_name||"",phoneNumber:e.billingData.phone||"",streetAddress:e.billingData.address_1||"",extendedAddress:e.billingData.address_2||"",locality:e.billingData.city||"",region:e.billingData.state.length<=2?e.billingData.state:"",postalCode:e.billingData.postcode||"",countryCodeAlpha2:e.billingData.country.length<=2?e.billingData.country:""},additionalInformation:{shippingGivenName:t.first_name||"",shippingSurname:t.last_name||"",shippingPhone:t.phone||"",shippingAddress:{streetAddress:t.address_1||"",extendedAddress:t.address_2||"",locality:t.city||"",region:t.state.length<=2?t.state:"",postalCode:t.postcode||"",countryCodeAlpha2:t.country.length<=2?t.country:""}}};return f&&(r.challengeRequested=!0,"0.00"===c&&v&&(r.amount=v.toFixed(2))),r}),[c,e.billingData,t]),I=(0,y.useCallback)(((e,t)=>(u("Verifying 3D Secure.",M),D.verifyCard({...M,nonce:e,bin:t,onLookupComplete:(e,t)=>{u("3DS lookup complete",e),t()}}))),[D,M]),A=(0,y.useCallback)((()=>{const e={wc_braintree_device_data:x};return T||(e[`wc-${o}-tokenize-payment-method`]=!0),p&&(e[`wc-${o}-test-amount`]=p),e}),[x,T,p]);return{testAmount:p,setTestAmount:m,setupIntegration:R,getPaymentMethodData:A,verify3DSecure:I,hostedFieldsInstance:C,threeDSecureInstance:D}},E=window.wc.blocksCheckout;var C=function r(n){var s=t[n];if(void 0!==s)return s.exports;var a=t[n]={exports:{}};return e[n](a,a.exports,r),a.exports}(848);const{fieldsErrorMessages:k,cscRequired:D}=d(),j=e=>{const{components:{LoadingMask:t},isLoaded:r,hostedFieldsInstance:s,token:a=null}=e,[i,c]=(0,y.useState)({number:"",expirationDate:"",cvv:""});return(0,y.useEffect)((()=>{s&&s.on("validityChange",(function(e){const t=e.fields[e.emittedBy];t.isValid||t.isPotentiallyValid?(c((t=>({...t,[e.emittedBy]:""}))),t.container.classList.remove("has-error")):(c((t=>({...t,[e.emittedBy]:k[`card_${e.emittedBy}_invalid`]||(0,n.sprintf)(/** translators: Placeholders: %s - invalid field name */ /** translators: Placeholders: %s - invalid field name */
(0,n.__)("%s is invalid","woocommerce-gateway-paypal-powered-by-braintree"),e.emittedBy)}))),t.container.classList.add("has-error"))}))}),[s]),(0,C.jsx)(t,{isLoading:!r,showSpinner:!0,children:(0,C.jsxs)("div",{className:"wc-block-card-elements payment_method_braintree_credit_card",children:[!a&&(0,C.jsxs)(C.Fragment,{children:[(0,C.jsxs)("div",{className:"wc-block-gateway-container wc-card-number-element",children:[(0,C.jsx)("div",{id:`wc-${o}-account-number-hosted`,className:"wc-block-gateway-input empty wc-braintree-hosted-field-card-number"}),(0,C.jsx)("label",{htmlFor:`wc-${o}-account-number-hosted`,children:(0,n.__)("Card Number","woocommerce-gateway-paypal-powered-by-braintree")}),(0,C.jsx)(E.ValidationInputError,{errorMessage:i.number})]}),(0,C.jsxs)("div",{className:"wc-block-gateway-container wc-card-expiry-element",children:[(0,C.jsx)("div",{id:`wc-${o}-expiry-hosted`,className:"wc-block-gateway-input empty wc-braintree-hosted-field-expiry"}),(0,C.jsx)("label",{htmlFor:`wc-${o}-expiry-hosted`,children:(0,n.__)("Expiration (MMYY)","woocommerce-gateway-paypal-powered-by-braintree")}),(0,C.jsx)(E.ValidationInputError,{errorMessage:i.expirationDate})]})]}),D&&(0,C.jsxs)("div",{className:"wc-block-gateway-container wc-card-cvc-element",children:[(0,C.jsx)("div",{id:`wc-${o}-csc-hosted${a?"-token":""}`,className:"wc-block-gateway-input empty wc-braintree-hosted-field-csc"}),(0,C.jsx)("label",{htmlFor:`wc-${o}-csc-hosted${a?"-token":""}`,children:(0,n.__)("Card Security Code","woocommerce-gateway-paypal-powered-by-braintree")}),(0,C.jsx)(E.ValidationInputError,{errorMessage:i.cvv})]})]})})},T=window.wp.htmlEntities,{threeds:F,integrationErrorMessage:R,paymentErrorMessage:M,cscRequired:I}=d(),{braintree:A}=window,L=({checkoutFormHandler:e,eventRegistration:t,emitResponse:r,token:n=null})=>{const{onPaymentProcessing:s,onCheckoutAfterProcessingWithError:i,onCheckoutAfterProcessingWithSuccess:c}=t,{getPaymentMethodData:l,hostedFieldsInstance:m,verify3DSecure:h}=e;return((e,t,r,n,s,i=null)=>{(0,y.useEffect)((()=>{const c={type:t.responseTypes.ERROR,messageContext:t.noticeContexts.PAYMENTS},l=F&&F.enabled&&A&&A.threeDSecure,m=!(i&&!I);let y=!1;const h=e((async()=>{if(m&&!s)return{...c,message:R};try{const e=r();let p,h,g,w;if(m){const t=await s.tokenize();if([p,h,g,w]=[t.nonce,t.details.bin,t.details.cardType,t.type],!p)return{...c,message:t.message};e.wc_braintree_credit_card_payment_nonce=p}if(i)try{const t=await(async e=>{const{ajaxUrl:t,tokenDataNonce:r,paymentErrorMessage:n}=d(),s=new FormData;s.append("action",`wc_${a}_get_token_data`),s.append("token_id",e),s.append("nonce",r);const o=await fetch(t,{method:"POST",body:s}),i=await o.json();if(i&&!i.success){const e=i.data&&i.data.message||n;throw new Error(e)}if(i&&i.success&&i.data)return i.data;throw new Error(n)})(i);t&&t.nonce&&(p=t.nonce,h=t.bin,y=!0),e.token=t.token,e[`wc-${o}-payment-token`]=t.token}catch(e){return{...c,message:e.message||M}}if(l&&(i&&y||"CreditCard"===w&&F.card_types.includes(g))){const t=await n(p,h);if(u("3D Secure Response received",t),F.liability_shift_always_required&&!t.liabilityShifted)return{...c,message:F.liability_shift_message};e[`wc-${o}-card-type`]=i?"":g.replace(" ","").toLowerCase(),e[`wc-${o}-3d-secure-enabled`]="1",e[`wc-${o}-3d-secure-verified`]="1",e.wc_braintree_credit_card_payment_nonce=t.nonce}return{type:t.responseTypes.SUCCESS,meta:{paymentMethodData:e}}}catch(e){u(`Payment Error: ${e.message}`,e);const t=p(e,i)||e.message;return{...c,message:(0,T.decodeEntities)(t)}}}));return h}),[t.responseTypes.SUCCESS,t.responseTypes.ERROR,t.noticeContexts.PAYMENTS,e,r,s,n,i])})(s,r,l,h,m,n),((e,t,r)=>{(0,y.useEffect)((()=>{const n=e=>{let t={type:r.responseTypes.SUCCESS};const{paymentStatus:n,paymentDetails:s}=e.processingResponse;return n===r.responseTypes.FAIL&&s.result===r.responseTypes.FAIL&&s.message&&(t={type:r.responseTypes.FAIL,message:s.message,messageContext:r.noticeContexts.PAYMENTS,retry:!0}),t},s=e(n),a=t(n);return()=>{s(),a()}}),[e,t,r.noticeContexts.PAYMENTS,r.responseTypes.FAIL,r.responseTypes.SUCCESS])})(i,c,r),null},{description:$,isTestEnvironment:N}=d(),P=({testAmount:e,setTestAmount:t})=>(0,C.jsxs)(C.Fragment,{children:[!!N&&(0,C.jsx)("span",{children:(0,n.__)("TEST MODE ENABLED","woocommerce-gateway-paypal-powered-by-braintree")}),(0,C.jsxs)("p",{children:[(0,T.decodeEntities)($||""),(0,C.jsx)("br",{}),!!N&&(0,C.jsx)("span",{dangerouslySetInnerHTML:{__html:(0,n.__)("Test credit card numbers: <code>378282246310005</code> or <code>4111111111111111</code>","woocommerce-gateway-paypal-powered-by-braintree")}})]}),!!N&&(0,C.jsxs)(C.Fragment,{children:[(0,C.jsx)(E.ValidatedTextInput,{id:`wc-${o}-test-amount`,type:"text",label:(0,n.__)("Test Amount","woocommerce-gateway-paypal-powered-by-braintree"),value:e,onChange:t}),(0,C.jsx)("p",{style:{fontSize:"10px"},dangerouslySetInnerHTML:{__html:(0,n.sprintf)(/** translators: Placeholders: %1$s - <a> tag, %2$s - </a> tag */ /** translators: Placeholders: %1$s - <a> tag, %2$s - </a> tag */
(0,n.__)("Enter a %1$stest amount%2$s to trigger a specific error response, or leave blank to use the order total.","woocommerce-gateway-paypal-powered-by-braintree"),'<a href="https://developers.braintreepayments.com/reference/general/testing/php#test-amounts">',"</a>")}})]})]}),{integrationErrorMessage:O}=d(),B=m(),q=(0,i.getSetting)("isBlockTheme")?"wc-block-components-notice-banner is-error":"woocommerce-error",U=e=>{const{emitResponse:t,eventRegistration:r}=e,{PaymentMethodIcons:n}=e.components,s=x(e),{setupIntegration:a,hostedFieldsInstance:o,testAmount:i,setTestAmount:c}=s,[d,l]=(0,y.useState)(""),[p,m]=(0,y.useState)(!1);return(0,y.useEffect)((()=>{let e,t,r;return async function(){try{const{hostedFields:n,dataCollector:s,threeDSecure:o}=await a();[e,t,r]=[n,s,o],m(!0)}catch(e){u(`Integration Error: ${e.message}`,e),l(O)}}(),()=>{m(!1),e&&e.teardown(),t&&t.teardown(),r&&r.teardown()}}),[a]),d?(0,C.jsx)("div",{className:q,children:d}):(0,C.jsxs)(C.Fragment,{children:[(0,C.jsx)(P,{testAmount:i,setTestAmount:c}),(0,C.jsx)(j,{...e,isLoaded:p,hostedFieldsInstance:o}),!!n&&!!B.length&&(0,C.jsx)(n,{icons:B,align:"left"}),(0,C.jsx)(L,{checkoutFormHandler:s,eventRegistration:r,emitResponse:t})]})},Y=(0,i.getSetting)("isBlockTheme")?"wc-block-components-notice-banner is-error":"woocommerce-error",{cscRequired:z,integrationErrorMessage:V}=d(),H=m(),{title:W,showSavedCards:K,showSaveOption:G,supports:J}=d(),X=e=>{const{PaymentMethodLabel:t}=e.components;return(0,C.jsx)(t,{text:W})},Q=({RenderedComponent:e,...t})=>(0,s.select)("core/editor")?null:(0,C.jsx)(e,{...t}),Z={name:a,label:(0,C.jsx)(X,{}),ariaLabel:(0,n.__)("Braintree CreditCard Payment Method","woocommerce-gateway-paypal-powered-by-braintree"),canMakePayment:()=>!0,content:(0,C.jsx)(Q,{RenderedComponent:U}),edit:(0,C.jsx)(Q,{RenderedComponent:U}),savedTokenComponent:(0,C.jsx)(Q,{RenderedComponent:e=>{const{emitResponse:t,eventRegistration:r,token:s}=e,a=x(e),{setupIntegration:o,hostedFieldsInstance:i}=a,[c,d]=(0,y.useState)(""),[l,p]=(0,y.useState)(!1);return(0,y.useEffect)((()=>{let e,t,r;return async function(){try{const{hostedFields:n,dataCollector:s,threeDSecure:a}=await o();[e,t,r]=[n,s,a],p(!0)}catch(e){u(`Integration Error: ${e.message}`,e),d(V)}}(),()=>{p(!1),e&&e.teardown(),t&&t.teardown(),r&&r.teardown()}}),[o]),c?(0,C.jsx)("div",{className:Y,children:c}):(0,C.jsxs)("div",{className:"wc-braintree-hosted-fields-saved-token is-small",children:[z&&(0,C.jsx)("p",{className:"wc-block-components-checkout-step__description",children:(0,n.__)("Card Security Code is required to make payments using saved cards","woocommerce-gateway-paypal-powered-by-braintree")}),(0,C.jsx)(j,{...e,token:s,isLoaded:l,hostedFieldsInstance:i}),(0,C.jsx)(L,{checkoutFormHandler:a,eventRegistration:r,emitResponse:t,token:s})]})}}),icons:H,supports:{showSavedCards:K||!1,showSaveOption:G||!1,features:J||[]}};(0,r.registerPaymentMethod)(Z)})();